{% extends "base.html" %}
{% block title %}Code Classroom | Class{% endblock %}
{% block main %}

<main>
    <div class="classBannerContainer">
        <div class="pills">
            <a id="settingPill" style="display: none;" href="/classroom/{{classid}}/settings"><svg width="24"
                    height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12.012 2.25c.734.008 1.465.093 2.182.253a.75.75 0 0 1 .582.649l.17 1.527a1.384 1.384 0 0 0 1.927 1.116l1.401-.615a.75.75 0 0 1 .85.174 9.792 9.792 0 0 1 2.204 3.792.75.75 0 0 1-.271.825l-1.242.916a1.381 1.381 0 0 0 0 2.226l1.243.915a.75.75 0 0 1 .272.826 9.797 9.797 0 0 1-2.204 3.792.75.75 0 0 1-.848.175l-1.407-.617a1.38 1.38 0 0 0-1.926 1.114l-.169 1.526a.75.75 0 0 1-.572.647 9.518 9.518 0 0 1-4.406 0 .75.75 0 0 1-.572-.647l-.168-1.524a1.382 1.382 0 0 0-1.926-1.11l-1.406.616a.75.75 0 0 1-.849-.175 9.798 9.798 0 0 1-2.204-3.796.75.75 0 0 1 .272-.826l1.243-.916a1.38 1.38 0 0 0 0-2.226l-1.243-.914a.75.75 0 0 1-.271-.826 9.793 9.793 0 0 1 2.204-3.792.75.75 0 0 1 .85-.174l1.4.615a1.387 1.387 0 0 0 1.93-1.118l.17-1.526a.75.75 0 0 1 .583-.65c.717-.159 1.45-.243 2.201-.252Zm0 1.5a9.135 9.135 0 0 0-1.354.117l-.109.977A2.886 2.886 0 0 1 6.525 7.17l-.898-.394a8.293 8.293 0 0 0-1.348 2.317l.798.587a2.881 2.881 0 0 1 0 4.643l-.799.588c.32.842.776 1.626 1.348 2.322l.905-.397a2.882 2.882 0 0 1 4.017 2.318l.11.984c.889.15 1.798.15 2.687 0l.11-.984a2.881 2.881 0 0 1 4.018-2.322l.905.396a8.296 8.296 0 0 0 1.347-2.318l-.798-.588a2.881 2.881 0 0 1 0-4.643l.796-.587a8.293 8.293 0 0 0-1.348-2.317l-.896.393a2.884 2.884 0 0 1-4.023-2.324l-.11-.976a8.988 8.988 0 0 0-1.333-.117ZM12 8.25a3.75 3.75 0 1 1 0 7.5 3.75 3.75 0 0 1 0-7.5Zm0 1.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"
                        fill="#ffffff" />
                </svg>Settings</a>
            <button id="leavePill" style="display: none;"><svg width="24" height="24" fill="none" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M6.25 2A2.25 2.25 0 0 0 4 4.25v15.5A2.25 2.25 0 0 0 6.25 22h6.56a6.518 6.518 0 0 1-1.078-1.5H6.25a.75.75 0 0 1-.75-.75V4.25a.75.75 0 0 1 .75-.75h11.5a.75.75 0 0 1 .75.75v6.826c.523.081 1.026.224 1.5.422V4.25A2.25 2.25 0 0 0 17.75 2H6.25ZM17.5 23a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11Zm3.5-5.5a.5.5 0 0 1-.5.5h-4.793l1.647 1.646a.5.5 0 0 1-.708.708l-2.5-2.5a.5.5 0 0 1 0-.708l2.5-2.5a.5.5 0 0 1 .708.708L15.707 17H20.5a.5.5 0 0 1 .5.5ZM8.5 13.25a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"
                        fill="#ffffff" />
                </svg>Leave</button>
            <button id="classCodeButton"><svg width="24" height="24" fill="none" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M9.759 3H9.75a.75.75 0 0 0-.75.75v6.5c0 .414.336.75.75.75h2.625c.283 0 .898-.038 1.469-.345.296-.159.594-.398.815-.75.223-.356.341-.785.341-1.28 0-.516-.112-.962-.336-1.33a1.983 1.983 0 0 0-.472-.531c.237-.356.383-.815.383-1.389 0-.502-.096-.935-.291-1.296a1.938 1.938 0 0 0-.768-.78c-.537-.3-1.118-.3-1.333-.299H9.759Zm2.616 6.5H10.5V7.75h1.875c.247 0 .547.01.78.125.1.05.174.113.228.2.054.09.117.254.117.55 0 .248-.057.394-.112.482a.653.653 0 0 1-.255.227c-.25.134-.571.166-.758.166ZM10.5 6.25V4.5h1.663c.218 0 .448.011.621.108.07.04.13.093.18.184.052.096.111.272.111.583 0 .264-.054.422-.107.516a.562.562 0 0 1-.207.212c-.19.116-.442.146-.593.147H10.5ZM5.277 3a.75.75 0 0 1 .696.5L8.28 10a.75.75 0 1 1-1.414.5l-.338-.952H3.826l-.376.973a.75.75 0 1 1-1.4-.542l2.517-6.5A.75.75 0 0 1 5.277 3Zm-.041 2.907-.83 2.141h1.59l-.76-2.141Zm15.292-2.635c.616.302 1.1.872 1.428 1.784a.75.75 0 1 1-1.411.508c-.234-.648-.498-.858-.677-.946-.22-.107-.468-.118-.868-.118-.378 0-.623.12-.802.28-.195.173-.35.428-.464.733a4.157 4.157 0 0 0-.233 1.222v.016c0 .524.007 1.197.229 1.762.105.27.25.487.446.648.192.158.473.295.907.344.352.039 1.129-.022 1.484-.807a.75.75 0 0 1 1.366.62c-.77 1.699-2.459 1.74-3.016 1.678-.69-.077-1.253-.313-1.694-.677a3.043 3.043 0 0 1-.89-1.258C16 8.21 16 7.28 16 6.78V6.733l.001-.035a5.608 5.608 0 0 1 .328-1.71c.167-.446.435-.94.872-1.33.453-.403 1.052-.658 1.8-.658h.038c.36 0 .933-.001 1.489.272ZM16.97 15.138a.857.857 0 0 1 .251-.397c.129-.113.356-.241.778-.241.762 0 1 .5 1 .727 0 .245-.052.49-.19.664-.11.14-.378.359-1.101.359a.75.75 0 0 0 0 1.5c.273 0 .65.036.934.17a.653.653 0 0 1 .264.2c.045.064.093.167.093.357 0 .488-.152.704-.28.812-.151.128-.396.211-.72.211-.362 0-.567-.063-.692-.142-.112-.07-.24-.204-.345-.524a.75.75 0 1 0-1.425.469c.186.566.495 1.023.967 1.322.458.29.982.375 1.495.375.551 0 1.182-.138 1.687-.565.528-.445.813-1.116.813-1.958 0-.474-.13-.888-.371-1.227a1.966 1.966 0 0 0-.258-.294 2.19 2.19 0 0 0 .114-.132c.438-.55.515-1.192.515-1.597C20.5 14.154 19.572 13 18 13c-.765 0-1.351.247-1.77.616-.405.357-.61.789-.701 1.11a.75.75 0 0 0 1.442.412Zm-6.47.385c0-.528.443-1.023.985-1.023.407 0 .735.19.893.434.136.21.218.566-.093 1.095-.15.255-.376.482-.682.724-.152.12-.315.237-.493.363l-.074.052c-.152.107-.315.222-.472.34C9.82 18.069 9 18.855 9 20.25c0 .414.336.75.75.75h3.451a.75.75 0 0 0 0-1.5h-2.513c.16-.282.423-.525.779-.793.137-.103.28-.203.432-.312l.078-.054c.179-.127.37-.264.557-.41.372-.295.76-.658 1.045-1.142.557-.948.546-1.921.058-2.672C13.17 13.4 12.34 13 11.486 13 10.008 13 9 14.278 9 15.523a.75.75 0 0 0 1.5 0Zm-5.585 1.215c.211-.14.415-.3.608-.475v3.987a.75.75 0 0 0 1.5 0v-6.5a.75.75 0 0 0-1.484-.16c-.126.578-.691 1.39-1.456 1.9a.75.75 0 0 0 .832 1.248Z"
                        fill="#ffffff" />
                </svg>Class Code</button>
            <button id="people"><svg width="24" height="24" fill="none" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M14.75 15c.966 0 1.75.784 1.75 1.75l-.001.962c.117 2.19-1.511 3.297-4.432 3.297-2.91 0-4.567-1.09-4.567-3.259v-1c0-.966.784-1.75 1.75-1.75h5.5Zm0 1.5h-5.5a.25.25 0 0 0-.25.25v1c0 1.176.887 1.759 3.067 1.759 2.168 0 2.995-.564 2.933-1.757V16.75a.25.25 0 0 0-.25-.25Zm-11-6.5h4.376a4.007 4.007 0 0 0-.095 1.5H3.75a.25.25 0 0 0-.25.25v1c0 1.176.887 1.759 3.067 1.759.462 0 .863-.026 1.207-.077a2.743 2.743 0 0 0-1.173 1.576l-.034.001C3.657 16.009 2 14.919 2 12.75v-1c0-.966.784-1.75 1.75-1.75Zm16.5 0c.966 0 1.75.784 1.75 1.75l-.001.962c.117 2.19-1.511 3.297-4.432 3.297l-.169-.002a2.755 2.755 0 0 0-1.218-1.606c.387.072.847.108 1.387.108 2.168 0 2.995-.564 2.933-1.757V11.75a.25.25 0 0 0-.25-.25h-4.28a4.05 4.05 0 0 0-.096-1.5h4.376ZM12 8a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3ZM6.5 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm11 0a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm-11 1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm11 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"
                        fill="#fff" />
                </svg>People</button>
        </div>
        <div id="classBannerText" class="classBannerText">
            <h1 id="className">Class Name</h1>
            <p id="classSubTitle">Class Subtitle</p>
        </div>
        <h1 class="classCodeText" id="classCodeText">{{classid}}</h1>
        <img id="classBanner">
    </div>
    <div class="classroomContentContainer">
        <div class="classroomMessagesContainer" id="classroomMessagesContainer">
            <span class="classroomTitleContainer">
                <strong>Messages</strong>
                <button id="messageButton"><svg width="24" height="24" fill="none" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.75 3a.75.75 0 0 1 .743.648l.007.102.001 7.25h7.253a.75.75 0 0 1 .102 1.493l-.102.007h-7.253l.002 7.25a.75.75 0 0 1-1.493.101l-.007-.102-.002-7.249H3.752a.75.75 0 0 1-.102-1.493L3.752 11h7.25L11 3.75a.75.75 0 0 1 .75-.75Z"
                            fill="#ffffff" />
                    </svg></button>
            </span>
            <div id="messageInputContainer" class="messageInputContainer">
                <div>
                    <textarea id="messageInput" placeholder="Enter message"></textarea>
                    <div>
                        <button class="secondaryButton iconButton" id="messageCancelButton"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m4.397 4.554.073-.084a.75.75 0 0 1 .976-.073l.084.073L12 10.939l6.47-6.47a.75.75 0 1 1 1.06 1.061L13.061 12l6.47 6.47a.75.75 0 0 1 .072.976l-.073.084a.75.75 0 0 1-.976.073l-.084-.073L12 13.061l-6.47 6.47a.75.75 0 0 1-1.06-1.061L10.939 12l-6.47-6.47a.75.75 0 0 1-.072-.976l.073-.084-.073.084Z" fill="#ffffff"/></svg></button>
                        <button class="secondaryButton iconButton" id="importantButton"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.002a3.875 3.875 0 0 0-3.875 3.875c0 2.92 1.207 6.552 1.813 8.199a2.187 2.187 0 0 0 2.064 1.423c.904 0 1.739-.542 2.063-1.418.606-1.64 1.81-5.254 1.81-8.204A3.875 3.875 0 0 0 12 2.002ZM9.625 5.877a2.375 2.375 0 0 1 4.75 0c0 2.655-1.111 6.043-1.717 7.684a.686.686 0 0 1-.655.438.687.687 0 0 1-.657-.44c-.607-1.652-1.721-5.058-1.721-7.682ZM12.001 17.001a2.501 2.501 0 1 0 0 5.002 2.501 2.501 0 0 0 0-5.002ZM11 19.502a1.001 1.001 0 1 1 2.002 0 1.001 1.001 0 0 1-2.002 0Z" fill="#ffffff"/></svg></button>
                        <button class="primaryButton iconButton" id="sendMessageButton"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5.694 12 2.299 3.272c-.236-.607.356-1.188.942-.982l.093.04 18 9a.75.75 0 0 1 .097 1.283l-.097.058-18 9c-.583.291-1.217-.244-1.065-.847l.03-.096L5.694 12 2.299 3.272 5.694 12ZM4.402 4.54l2.61 6.71h6.627a.75.75 0 0 1 .743.648l.007.102a.75.75 0 0 1-.649.743l-.101.007H7.01l-2.609 6.71L19.322 12 4.401 4.54Z" fill="#ffffff"/></svg></button>
                    </div>
                </div>
            </div>
            <div class="messageContainer">

            </div>
        </div>
        <div class="classroomTasksContainer" id="classroomTasksContainer">
            <span class="classroomTitleContainer">
                <strong>Tasks</strong>
                <a id="createTaskButton" class="createTaskButton"><svg width="24" height="24" fill="none"
                        viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.75 3a.75.75 0 0 1 .743.648l.007.102.001 7.25h7.253a.75.75 0 0 1 .102 1.493l-.102.007h-7.253l.002 7.25a.75.75 0 0 1-1.493.101l-.007-.102-.002-7.249H3.752a.75.75 0 0 1-.102-1.493L3.752 11h7.25L11 3.75a.75.75 0 0 1 .75-.75Z"
                            fill="#ffffff" />
                    </svg></a>
            </span>
            <div class="createOption" id="createOption">
                <a>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M5 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V5.414a1.5 1.5 0 0 0-.44-1.06L9.647 1.439A1.5 1.5 0 0 0 8.586 1zM4 3a1 1 0 0 1 1-1h3v2.5A1.5 1.5 0 0 0 9.5 6H12v7a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1zm7.793 2H9.5a.5.5 0 0 1-.5-.5V2.207zM7 7.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M7.5 9a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zM7 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M5.5 8a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1M6 9.5a.5.5 0 1 1-1 0a.5.5 0 0 1 1 0M5.5 12a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1"/></svg>
                    <span>Task</span>
                </a>
                <a>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M6 3a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm0 1h4v1H6zm5-3H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.5a.5.5 0 0 0 0-1H5a1 1 0 0 1-1-1v-.003h8.5a.5.5 0 0 0 .5-.5V3a2 2 0 0 0-2-2M4 11.997V3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v8.997z"/></svg>
                    <span>Resource</span>
                </a>
                <a>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M15 8a2 2 0 0 0-2-2H3a2 2 0 1 0 0 4h10a2 2 0 0 0 2-2m-2 1H3a1 1 0 1 1 0-2h10a1 1 0 1 1 0 2M9 3a2 2 0 0 0-2-2H3a2 2 0 1 0 0 4h4a2 2 0 0 0 2-2M3 4a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2zm6 7a2 2 0 1 1 0 4H3a2 2 0 1 1 0-4zm0 3a1 1 0 1 0 0-2H3a1 1 0 1 0 0 2z"/></svg>
                    <span>Poll</span>
                </a>
            </div>
            <div class="taskContainer">
            </div>
        </div>
        <div style="display: none;" class="classroomPeopleContainer" id="classroomPeopleContainer">
            <span class="classroomTitleContainer">
                <strong>Classmates</strong>
            </span>
            <div id="peopleContainer" class="peopleContainer">

            </div>
        </div>
    </div>
</main>
<dialog id="resourceDialog" class="resourceDialog">
<div class="resourceDialogButtons">
    <button onclick="resourceDialog.close()" class="primaryButton iconButton"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="m2.589 2.716l.057-.07a.5.5 0 0 1 .638-.057l.07.057L8 7.293l4.646-4.647a.5.5 0 0 1 .708.708L8.707 8l4.647 4.646a.5.5 0 0 1 .057.638l-.057.07a.5.5 0 0 1-.638.057l-.07-.057L8 8.707l-4.646 4.647a.5.5 0 0 1-.708-.708L7.293 8L2.646 3.354a.5.5 0 0 1-.057-.638l.057-.07z"/></svg></button>
    <button class="secondaryButton iconButton"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M3.5 13h9a.5.5 0 0 1 .09.992L12.5 14h-9a.5.5 0 0 1-.09-.992zh9zM7.91 1.008L8 1a.5.5 0 0 1 .492.41l.008.09v8.792l2.682-2.681a.5.5 0 0 1 .638-.058l.07.058a.5.5 0 0 1 .057.638l-.058.069l-3.535 3.536a.5.5 0 0 1-.638.057l-.07-.057l-3.535-3.536a.5.5 0 0 1 .638-.765l.069.058L7.5 10.292V1.5a.5.5 0 0 1 .41-.492L8 1z"/></svg></button>
    <button id="deleteResource" class="dangerButton iconButton"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-1 0v-5a.5.5 0 0 1 .5-.5m-4.74 6.703A1.5 1.5 0 0 0 6.246 14h3.508a1.5 1.5 0 0 0 1.487-1.297L12.427 4H3.573z"/></svg></button>
    <div id="resourceDeleteCover" class="deleteCover" style="display: none;">
        <span>Are you sure?</span>
        <div class="deleteButtonContainer">
            <button id="confirmDeleteResource" class="dangerButton">Delete</button>
            <button id="cancelDeleteResource" class="whiteButton">Cancel</button>
        </div>
    </div>
</div>
<div class="resourceDialogPage">
    <h1 id="resourceTitle">Title</h1>
    <zero-md class="resourceDialogPageMD">
        <template data-append>
          <link type="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5/github-markdown-dark.min.css">
          <link type="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11/styles/github-dark.min.css">
          <style>
              .markdown-body {
                  padding: 0px !important;
                  box-sizing: border-box !important;
                  border-radius: 16px !important;
                  height: auto !important;
                  width: auto !important;
                  background-color: transparent  !important;
                  border: 1px solid transparent  !important;
                  font-family: "Lexend", sans-serif !important;
                  background-color: #1c202b !important;
              }
              .markdown-body > pre {
                  background-color: #32394b;
                  border-radius: 16px;
              }
              .markdown-body code:not(pre > code) {
                  background-color: #32394b;
                  border-radius: 16px;
                  color:#e7b9a2;
              }
          </style>
        </template>
        <script type="text/markdown" id="resourceMarkdown">
        </script>
      </zero-md>
</div>
</dialog>
<script>
    const resourceMarkdown = document.getElementById('resourceMarkdown');
    const resourceTitle = document.getElementById('resourceTitle');
    const resourceDialog = document.getElementById('resourceDialog');
    const classroomMessagesContainer = document.getElementById('classroomMessagesContainer');
    const classroomTasksContainer = document.getElementById('classroomTasksContainer');
    const classroomPeopleContainer = document.getElementById('classroomPeopleContainer');
    const peopleButton = document.getElementById('people');
    const importantButton = document.getElementById('importantButton');
    const deleteResource = document.getElementById('deleteResource');
    var currentResource = null;
    var messageImportant = false;
    importantButton.addEventListener('click', () => {
        messageImportant = !messageImportant;
        importantButton.classList.toggle('secondaryButton');
        importantButton.classList.toggle('dangerButton');
    });

    peopleButton.addEventListener('click', () => {
        if (peopleButton.innerText === "People") {
            classroomMessagesContainer.style.display = 'none';
            classroomTasksContainer.style.display = 'none';
            classroomPeopleContainer.style.display = 'flex';
            peopleButton.innerHTML = '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m4.397 4.554.073-.084a.75.75 0 0 1 .976-.073l.084.073L12 10.939l6.47-6.47a.75.75 0 1 1 1.06 1.061L13.061 12l6.47 6.47a.75.75 0 0 1 .072.976l-.073.084a.75.75 0 0 1-.976.073l-.084-.073L12 13.061l-6.47 6.47a.75.75 0 0 1-1.06-1.061L10.939 12l-6.47-6.47a.75.75 0 0 1-.072-.976l.073-.084-.073.084Z" fill="#fff"/></svg>Exit'
        } else {
            classroomMessagesContainer.style.display = 'flex';
            classroomTasksContainer.style.display = 'flex';
            classroomPeopleContainer.style.display = 'none';
            peopleButton.innerHTML = '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.754 14a2.249 2.249 0 0 1 2.25 2.249v.575c0 .894-.32 1.76-.902 2.438-1.57 1.834-3.957 2.739-7.102 2.739-3.146 0-5.532-.905-7.098-2.74a3.75 3.75 0 0 1-.898-2.435v-.577a2.249 2.249 0 0 1 2.249-2.25h11.501Zm0 1.5H6.253a.749.749 0 0 0-.75.749v.577c0 .536.192 1.054.54 1.461 1.253 1.468 3.219 2.214 5.957 2.214s4.706-.746 5.962-2.214a2.25 2.25 0 0 0 .541-1.463v-.575a.749.749 0 0 0-.749-.75ZM12 2.004a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z" fill="#fff"/></svg>People'
        }
    });

    const leavePill = document.getElementById('leavePill');
    const settingPill = document.getElementById('settingPill');
    const teacher = {{ teacher| tojson}};
    if (teacher) {
        settingPill.style.display = 'flex';
    } else {
        leavePill.style.display = 'flex';
        deleteResource.style.display = 'none';
    }

    const createTaskButton = document.getElementById('createTaskButton');
    const createOption = document.getElementById('createOption');
    createTaskButton.addEventListener('click', () => {
        createOption.classList.toggle('showCreateOptions');
        createTaskButton.classList.toggle('createTaskButtonSVGRotate');
    });
    const sendMessageButton = document.getElementById('sendMessageButton');
    const messageInputContainer = document.getElementById('messageInputContainer');
    const messageButton = document.getElementById('messageButton');
    const messageCancelButton = document.getElementById('messageCancelButton');
    const messageInput = document.getElementById('messageInput');
    const userID = {{ userID| tojson}};


    messageButton.addEventListener('click', () => {
        messageButton.classList.toggle('createTaskButtonSVGRotate');
        messageInputContainer.classList.toggle('messageInputContainerExpand');
    });

    messageCancelButton.addEventListener('click', () => {
        messageInput.value = '';
        messageInputContainer.classList.toggle('messageInputContainerExpand');
    });


    const className = document.getElementById('className');
    const classSubTitle = document.getElementById('classSubTitle');

    const thisClass = {{ user_class| tojson}};
    console.log(thisClass)
    if (thisClass.classInfo.settings.messageLock && !teacher) {
        messageButton.style.display = 'none';
    }
    messageLock = thisClass.classInfo.settings.messageLock;
    if (messageLock && !teacher) {
        messageButton.style.display = 'none';
    }

    if (!teacher) {
        createTaskButton.style.display = 'none';
    }
    classInfo = thisClass.classInfo;
    people = thisClass.members;
    console.log(people)
    people.forEach(person => {
        let container = document.createElement('div');
        let personName = document.createElement('strong');
        let personRole = document.createElement('p');
        let personAvatar = document.createElement('span');
        personName.innerText = person.username;
        if (person.role == "teacher") {
            personRole.innerText = "Teacher"
            personRole.classList.add('personRoleTeacher');
        } else {
            personRole.innerText = "Student"
        }
        personRole.classList.add('personRole');
        // Create SVG avatar instead of using an image
        personAvatar.innerHTML = `<svg class=svg_` + classInfo.coverImage + ` width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.754 14a2.249 2.249 0 0 1 2.25 2.249v.575c0 .894-.32 1.76-.902 2.438-1.57 1.834-3.957 2.739-7.102 2.739-3.146 0-5.532-.905-7.098-2.74a3.75 3.75 0 0 1-.898-2.435v-.577a2.249 2.249 0 0 1 2.249-2.25h11.501Zm0 1.5H6.253a.749.749 0 0 0-.75.749v.577c0 .536.192 1.054.54 1.461 1.253 1.468 3.219 2.214 5.957 2.214s4.706-.746 5.962-2.214a2.25 2.25 0 0 0 .541-1.463v-.575a.749.749 0 0 0-.749-.75ZM12 2.004a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 1.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Z" fill="#fff"/></svg>`;

        container.appendChild(personAvatar);
        container.appendChild(personName);
        container.appendChild(personRole);
        document.getElementById('peopleContainer').appendChild(container);
    });
    className.innerText = classInfo.name;
    classSubTitle.innerText = classInfo.subtitle;
    classBanner.src = "/static/coverImages/classroomBanners/" + classInfo.coverImage + "Gradient.webp"
    const classCodeButton = document.getElementById('classCodeButton');
    const classBannerText = document.getElementById('classBannerText');
    const classCodeText = document.getElementById('classCodeText');
    classCodeText.innerText = classInfo.id;
    let classCodeShown = false;
    classCodeButton.addEventListener('click', () => {
        classCodeShown = !classCodeShown;
        classBannerText.classList.toggle('classBannerTextExpand');
        classCodeText.classList.toggle('classCodeTextExpand');
    });

    const messages = thisClass.messages;
    const messageContainer = document.querySelector('.messageContainer');
    messages.forEach(message => {
        let container = document.createElement('span');
        console.log(message)
        if (message.messageImportant) {
            container.classList.add('importantMessage');
        }
        let messageTitleContainer = document.createElement('div');
        let messageTitle = document.createElement('strong');
        let messageDate = document.createElement('p');
        let messageText = document.createElement('p');
        let deleteIcon = document.createElement('span');
        let deleteCover = document.createElement('div');
        let deleteText = document.createElement('span');
        let deleteButton = document.createElement('button');
        let cancelButton = document.createElement('button');
        let deleteButtonContainer = document.createElement('div');
        deleteText.innerText = 'Are you sure?';
        deleteButton.innerText = 'Delete';
        cancelButton.innerText = 'Cancel';
        cancelButton.addEventListener('click', () => {
            deleteCover.style.display = 'none';
        });
        deleteButtonContainer.appendChild(deleteButton);
        deleteButtonContainer.appendChild(cancelButton);
        deleteCover.appendChild(deleteText);
        deleteCover.appendChild(deleteButtonContainer);
        deleteCover.classList.add('deleteCover');
        deleteButtonContainer.classList.add('deleteButtonContainer');
        deleteButton.classList.add('dangerButton');
        cancelButton.classList.add('whiteButton');
        messageTitleContainer.appendChild(deleteCover);
        // Create message bubble SVG
        let messageBubbleSvg = document.createElement('span');
        messageBubbleSvg.innerHTML = '<svg class=svg_' + classInfo.coverImage + ' width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.96 9.96 0 0 1-4.587-1.112l-3.826 1.067a1.25 1.25 0 0 1-1.54-1.54l1.068-3.823A9.96 9.96 0 0 1 2 12C2 6.477 6.477 2 12 2Zm0 1.5A8.5 8.5 0 0 0 3.5 12c0 1.47.373 2.883 1.073 4.137l.15.27-1.112 3.984 3.987-1.112.27.15A8.5 8.5 0 1 0 12 3.5ZM8.75 13h4.498a.75.75 0 0 1 .102 1.493l-.102.007H8.75a.75.75 0 0 1-.102-1.493L8.75 13h4.498H8.75Zm0-3.5h6.505a.75.75 0 0 1 .101 1.493l-.101.007H8.75a.75.75 0 0 1-.102-1.493L8.75 9.5h6.505H8.75Z" fill="#ffffff"/></svg>';

        // Create delete SVG
        deleteIcon.classList.add('deleteMessage');
        deleteIcon.addEventListener('click', () => {
            deleteCover.style.display = 'flex';
        });
        deleteIcon.innerHTML = '<svg class="deleteMessageSVG" width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 1.75a3.25 3.25 0 0 1 3.245 3.066L15.25 5h5.25a.75.75 0 0 1 .102 1.493L20.5 6.5h-.796l-1.28 13.02a2.75 2.75 0 0 1-2.561 2.474l-.176.006H8.313a2.75 2.75 0 0 1-2.714-2.307l-.023-.174L4.295 6.5H3.5a.75.75 0 0 1-.743-.648L2.75 5.75a.75.75 0 0 1 .648-.743L3.5 5h5.25A3.25 3.25 0 0 1 12 1.75Zm6.197 4.75H5.802l1.267 12.872a1.25 1.25 0 0 0 1.117 1.122l.127.006h7.374c.6 0 1.109-.425 1.225-1.002l.02-.126L18.196 6.5ZM13.75 9.25a.75.75 0 0 1 .743.648L14.5 10v7a.75.75 0 0 1-1.493.102L13 17v-7a.75.75 0 0 1 .75-.75Zm-3.5 0a.75.75 0 0 1 .743.648L11 10v7a.75.75 0 0 1-1.493.102L9.5 17v-7a.75.75 0 0 1 .75-.75Zm1.75-6a1.75 1.75 0 0 0-1.744 1.606L10.25 5h3.5A1.75 1.75 0 0 0 12 3.25Z" fill="#ffffff"/></svg>';
        deleteButton.addEventListener('click', () => {
            fetch("/endpoint/class/message/delete", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    classid: classInfo.id,
                    messageid: message.messageId
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'complete') {
                        container.remove();
                    }
                })
        });
        // Build the message container structure
        container.appendChild(messageTitleContainer);
        messageTitleContainer.appendChild(messageBubbleSvg);
        messageTitleContainer.appendChild(messageTitle);
        messageTitleContainer.appendChild(messageDate);
        if (teacher || message.userName === {{username|tojson}}) {
            messageTitleContainer.appendChild(deleteIcon);
        }
    container.appendChild(messageText);

    // Set text content for message elements
    messageTitle.textContent = message.userName;
    messageDate.textContent = message.date;
    messageText.textContent = message.message;

    // Add classes
    messageTitleContainer.classList.add('messageTitleContainer');

    // Insert the new message at the top
    messageContainer.insertBefore(container, messageContainer.firstChild);

    // Reset and close the input container
    messageInput.value = '';
    messageInputContainer.classList.remove('messageInputContainerExpand');

    });

    const openResource = (description, taskName, id) => {
        console.log(description)
        resourceTitle.innerText = taskName;
        resourceMarkdown.textContent = description;
        currentResource = id;
        resourceDialog.showModal();
    }
    const tasks = thisClass.tasks;
    const taskContainer = document.querySelector('.taskContainer');
    tasks.forEach(task => {
        var taskType = task.type
        let container = document.createElement('a');
        container.id = task.id;
        let taskTitle = document.createElement('strong');
        let taskDate = document.createElement('p');
        let taskIndercater = document.createElement('div');
        let svg
        if (taskType == "resource"){
            svg = '<svg class=svg_' + classInfo.coverImage + ' xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M6 3a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm0 1h4v1H6zm5-3H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.5a.5.5 0 0 0 0-1H5a1 1 0 0 1-1-1v-.003h8.5a.5.5 0 0 0 .5-.5V3a2 2 0 0 0-2-2M4 11.997V3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v8.997z"/></svg>'
            container.innerHTML = svg;
            container.appendChild(taskTitle);
            container.addEventListener('click', () => {
                openResource(task.taskDescription, task.taskName, task.id)
            })
        }else if (taskType == "poll"){
            
            const voters = task.voters;
            console.log(voters)
            svg = `<svg class=svg_` + classInfo.coverImage + ` xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M15 8a2 2 0 0 0-2-2H3a2 2 0 1 0 0 4h10a2 2 0 0 0 2-2m-2 1H3a1 1 0 1 1 0-2h10a1 1 0 1 1 0 2M9 3a2 2 0 0 0-2-2H3a2 2 0 1 0 0 4h4a2 2 0 0 0 2-2M3 4a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2zm6 7a2 2 0 1 1 0 4H3a2 2 0 1 1 0-4zm0 3a1 1 0 1 0 0-2H3a1 1 0 1 0 0 2z"/></svg>`
            taskTopBar = document.createElement('div');
            taskTopBar.classList.add('pollTopBar');
            
            // Create title container to hold both the SVG and title
            let titleContainer = document.createElement('div');
            titleContainer.classList.add('pollTitleContainer');
            titleContainer.innerHTML = svg;
            titleContainer.appendChild(taskTitle);
            
            // Create delete icon and confirmation dialog
            if (teacher) {
                let deleteIcon = document.createElement('span');
                let deleteCover = document.createElement('div');
                let deleteText = document.createElement('span');
                let deleteButton = document.createElement('button');
                let cancelButton = document.createElement('button');
                let deleteButtonContainer = document.createElement('div');
                
                deleteText.innerText = 'Are you sure?';
                deleteButton.innerText = 'Delete';
                cancelButton.innerText = 'Cancel';
                cancelButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    deleteCover.style.display = 'none';
                });
                
                deleteButtonContainer.appendChild(deleteButton);
                deleteButtonContainer.appendChild(cancelButton);
                deleteCover.appendChild(deleteText);
                deleteCover.appendChild(deleteButtonContainer);
                deleteCover.classList.add('deleteCover');
                deleteButtonContainer.classList.add('deleteButtonContainer');
                deleteButton.classList.add('dangerButton');
                cancelButton.classList.add('whiteButton');
                
                deleteIcon.classList.add('deleteMessage');
                deleteIcon.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    deleteCover.style.display = 'flex';
                });
                deleteIcon.innerHTML = '<svg class="deleteMessageSVG" width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 1.75a3.25 3.25 0 0 1 3.245 3.066L15.25 5h5.25a.75.75 0 0 1 .102 1.493L20.5 6.5h-.796l-1.28 13.02a2.75 2.75 0 0 1-2.561 2.474l-.176.006H8.313a2.75 2.75 0 0 1-2.714-2.307l-.023-.174L4.295 6.5H3.5a.75.75 0 0 1-.743-.648L2.75 5.75a.75.75 0 0 1 .648-.743L3.5 5h5.25A3.25 3.25 0 0 1 12 1.75Zm6.197 4.75H5.802l1.267 12.872a1.25 1.25 0 0 0 1.117 1.122l.127.006h7.374c.6 0 1.109-.425 1.225-1.002l.02-.126L18.196 6.5ZM13.75 9.25a.75.75 0 0 1 .743.648L14.5 10v7a.75.75 0 0 1-1.493.102L13 17v-7a.75.75 0 0 1 .75-.75Zm-3.5 0a.75.75 0 0 1 .743.648L11 10v7a.75.75 0 0 1-1.493.102L9.5 17v-7a.75.75 0 0 1 .75-.75Zm1.75-6a1.75 1.75 0 0 0-1.744 1.606L10.25 5h3.5A1.75 1.75 0 0 0 12 3.25Z" fill="#ffffff"/></svg>';
                
                deleteButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    fetch("/endpoint/task/delete", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            classid: classInfo.id,
                            taskid: task.id
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'complete') {
                            container.remove();
                        }
                    })
                });
                
                taskTopBar.appendChild(titleContainer);
                taskTopBar.appendChild(deleteIcon);
                taskTopBar.appendChild(deleteCover);
            } else {
                taskTopBar.appendChild(titleContainer);
            }
            
            taskTitle.innerText = task.taskName;
            container.appendChild(taskTopBar);
            container.classList.add('pollTask');
            const pollOptions = task.options;
            const pollOptionsKeys = Object.keys(pollOptions);
            pollOptionsKeys.forEach(option => {
                let totalVotes = voters.length;
                let pollOption = document.createElement('div');
                let pollOptionText = document.createElement('p');
                let pollOptionCount = document.createElement('p');
                pollOption.classList.add('pollOption');
                pollOptionText.innerText = pollOptions[option]["option"];
                let votePercentage = totalVotes > 0 ? (pollOptions[option]["votes"] / totalVotes * 100).toFixed(0) : 0;
                pollOptionCount.innerText = votePercentage + "%";
                
                pollOption.style.backgroundImage = `linear-gradient(to right, #30384E ${votePercentage}%, #242B3E ${votePercentage}%)`;
                pollOption.appendChild(pollOptionText);
                pollOption.appendChild(pollOptionCount);
                container.appendChild(pollOption);
                if(!voters.includes(userID)){
                    pollOption.addEventListener('click', () => {
                        fetch("/endpoint/poll/vote", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                classid: classInfo.id,
                                pollid: task.id,
                                option: pollOptions[option]["option"]
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'complete') {
                                    pollOptionCount.innerText = parseInt(pollOptionCount.innerText) + 1;
                                    voters.push(userID);
                                }
                            })
                    })
                }
            });
        }
        
        
        else{
            svg = '<svg class=svg_' + classInfo.coverImage + ' width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 12.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Zm.75 2.25a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM7 18.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Zm3.75-6.75a.75.75 0 0 0 0 1.5h5.5a.75.75 0 0 0 0-1.5h-5.5ZM10 15.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 0 1.5h-5.5a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h5.5a.75.75 0 0 0 0-1.5h-5.5Zm8.664-9.086-5.829-5.828a.493.493 0 0 0-.049-.04.626.626 0 0 1-.036-.03 2.072 2.072 0 0 0-.219-.18.652.652 0 0 0-.08-.044l-.048-.024-.05-.029c-.054-.031-.109-.063-.166-.087a1.977 1.977 0 0 0-.624-.138c-.02-.001-.04-.004-.059-.007A.605.605 0 0 0 12.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9.828a2 2 0 0 0-.586-1.414ZM18.5 20a.5.5 0 0 1-.5.5H6a.5.5 0 0 1-.5-.5V4a.5.5 0 0 1 .5-.5h6V8a2 2 0 0 0 2 2h4.5v10Zm-5-15.379L17.378 8.5H14a.5.5 0 0 1-.5-.5V4.621Z" fill="#ffffff"/></svg>'
            container.innerHTML = svg;
            container.appendChild(taskTitle);
            container.appendChild(taskDate);
            container.appendChild(taskIndercater);
            container.href = '/task/' + classInfo.id + '/' + task.id;
        }
        const dueDate = new Date(task.taskDue);
        const currentDate = new Date();

        currentDate.setHours(0, 0, 0, 0);
        dueDate.setHours(0, 0, 0, 0);
        if (teacher) {
        taskIndercater.classList.add('taskIndercater', 'complete');
    }else {
        if (dueDate < currentDate && task.student_data[userID].status !== 'completed') {
            taskIndercater.classList.add('taskIndercater', 'missing');
        } else if (!Object.keys(task.student_data).includes(userID))
            taskIndercater.classList.add('taskIndercater', 'notstarted');
        else {
            taskIndercater.classList.add('taskIndercater', task.student_data[userID].status);
        }
    }

    taskTitle.innerText = task.taskName;
    taskDate.innerText = task.taskDue;
    taskContainer.insertBefore(container, taskContainer.firstChild);
    });


    const sendMessage = () => {
        const message = messageInput.value;
        fetch("/endpoint/class/message", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                classid: classInfo.id,
                message: message,
                messageImportant: messageImportant
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'complete') {
                    let container = document.createElement('span');
                    let messageTitleContainer = document.createElement('div');
                    let messageTitle = document.createElement('strong');
                    let messageDate = document.createElement('p');
                    let messageText = document.createElement('p');
                    let deleteIcon = document.createElement('span');
                    let deleteCover = document.createElement('div');
                    let deleteText = document.createElement('span');
                    let deleteButton = document.createElement('button');
                    let cancelButton = document.createElement('button');
                    let deleteButtonContainer = document.createElement('div');
                    if (messageImportant){
                        container.classList.add('importantMessage');
                    }
                    deleteText.innerText = 'Are you sure?';
                    deleteButton.innerText = 'Delete';
                    cancelButton.innerText = 'Cancel';
                    cancelButton.addEventListener('click', () => {
                        deleteCover.style.display = 'none';
                    });
                    deleteButtonContainer.appendChild(deleteButton);
                    deleteButtonContainer.appendChild(cancelButton);
                    deleteCover.appendChild(deleteText);
                    deleteCover.appendChild(deleteButtonContainer);
                    deleteCover.classList.add('deleteCover');
                    deleteButtonContainer.classList.add('deleteButtonContainer');
                    deleteButton.classList.add('deleteButton');
                    cancelButton.classList.add('cancelButton');
                    messageTitleContainer.appendChild(deleteCover);

                    // Create message bubble SVG
                    let messageBubbleSvg = document.createElement('span');
                    messageBubbleSvg.innerHTML = '<svg class=svg_' + classInfo.coverImage + ' width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.96 9.96 0 0 1-4.587-1.112l-3.826 1.067a1.25 1.25 0 0 1-1.54-1.54l1.068-3.823A9.96 9.96 0 0 1 2 12C2 6.477 6.477 2 12 2Zm0 1.5A8.5 8.5 0 0 0 3.5 12c0 1.47.373 2.883 1.073 4.137l.15.27-1.112 3.984 3.987-1.112.27.15A8.5 8.5 0 1 0 12 3.5ZM8.75 13h4.498a.75.75 0 0 1 .102 1.493l-.102.007H8.75a.75.75 0 0 1-.102-1.493L8.75 13h4.498H8.75Zm0-3.5h6.505a.75.75 0 0 1 .101 1.493l-.101.007H8.75a.75.75 0 0 1-.102-1.493L8.75 9.5h6.505H8.75Z" fill="#ffffff"/></svg>';

                    // Create delete SVG
                    deleteIcon.classList.add('deleteMessage');
                    deleteIcon.addEventListener('click', () => {
                        deleteCover.style.display = 'flex';
                    });
                    deleteIcon.innerHTML = '<svg class="deleteMessageSVG" width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 1.75a3.25 3.25 0 0 1 3.245 3.066L15.25 5h5.25a.75.75 0 0 1 .102 1.493L20.5 6.5h-.796l-1.28 13.02a2.75 2.75 0 0 1-2.561 2.474l-.176.006H8.313a2.75 2.75 0 0 1-2.714-2.307l-.023-.174L4.295 6.5H3.5a.75.75 0 0 1-.743-.648L2.75 5.75a.75.75 0 0 1 .648-.743L3.5 5h5.25A3.25 3.25 0 0 1 12 1.75Zm6.197 4.75H5.802l1.267 12.872a1.25 1.25 0 0 0 1.117 1.122l.127.006h7.374c.6 0 1.109-.425 1.225-1.002l.02-.126L18.196 6.5ZM13.75 9.25a.75.75 0 0 1 .743.648L14.5 10v7a.75.75 0 0 1-1.493.102L13 17v-7a.75.75 0 0 1 .75-.75Zm-3.5 0a.75.75 0 0 1 .743.648L11 10v7a.75.75 0 0 1-1.493.102L9.5 17v-7a.75.75 0 0 1 .75-.75Zm1.75-6a1.75 1.75 0 0 0-1.744 1.606L10.25 5h3.5A1.75 1.75 0 0 0 12 3.25Z" fill="#ffffff"/></svg>';
                    deleteButton.addEventListener('click', () => {
                        fetch("/endpoint/class/message/delete", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                classid: classInfo.id,
                                messageid: data.messageId
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'complete') {
                                    container.remove();
                                }
                            })
                    });
                    // Build the message container structure
                    container.appendChild(messageTitleContainer);
                    messageTitleContainer.appendChild(messageBubbleSvg);
                    messageTitleContainer.appendChild(messageTitle);
                    messageTitleContainer.appendChild(messageDate);
                    messageTitleContainer.appendChild(deleteIcon);
                    container.appendChild(messageText);


                    // Set text content for message elements
                    messageTitle.textContent = data.userName;
                    messageDate.textContent = data.date;
                    messageText.textContent = message;

                    // Add classes
                    messageTitleContainer.classList.add('messageTitleContainer');

                    // Insert the new message at the top
                    messageContainer.insertBefore(container, messageContainer.firstChild);

                    // Reset and close the input container
                    messageInput.value = '';
                    messageInputContainer.classList.remove('messageInputContainerExpand');
                    const errorContainer = document.querySelector('.errorMessageForMessage')
                    errorContainer.style.display = 'none';
                }
                else {
                    const errorContainer = document.querySelector('.errorMessageForMessage')
                    errorContainer.style.display = 'flex';
                    errorContainer.innerText = data.status;

                }
            })
    }

    sendMessageButton.addEventListener('click', sendMessage);
    messageInputContainer.classList.remove('messageInputContainerExpand');

    leavePill.addEventListener('click', () => {
        fetch("/endpoint/class/leave", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                classid: classInfo.id
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'complete') {
                    window.location.href = '/';
                }
            })
    });
    deleteResource.addEventListener('click', () => {
        document.getElementById('resourceDeleteCover').style.display = 'flex';
    });
    
    document.getElementById('cancelDeleteResource').addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        document.getElementById('resourceDeleteCover').style.display = 'none';
    });
    
    document.getElementById('confirmDeleteResource').addEventListener('click', () => {
        fetch("/endpoint/task/delete", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                classid: classInfo.id,
                taskid: currentResource
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'complete') {
                    resourceDialog.close()
                    document.getElementById(currentResource).remove();
                    currentResource = null;
                }
            })
    });
</script>


{% endblock %}