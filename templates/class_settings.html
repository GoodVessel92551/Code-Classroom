{% extends "base.html" %}
{% block title %}Booogle Code | Teach Coding The Easy Way{% endblock %}
{% block main %}

<main>
    <div class="classBannerContainer">
        <div class="pills">
            <a href="/classroom/{{classid}}"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.25 2A2.75 2.75 0 0 1 20 4.75V19.25a2.75 2.75 0 0 1-2.75 2.75H6.75A2.75 2.75 0 0 1 4 19.249V4.75c0-1.26.846-2.32 2-2.647V3.75c-.304.228-.5.59-.5 1v14.498c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25V4.75c0-.69-.56-1.25-1.25-1.25L15 3.5V2h2.25ZM14 2v8.139c0 .747-.8 1.027-1.29.764l-.082-.052-2.126-1.285-2.078 1.251c-.5.36-1.33.14-1.417-.558L7 10.14V2h7Zm-1.5 1.5h-4v5.523l1.573-.949a.923.923 0 0 1 .818-.024l1.61.974V3.5Z" fill="#ffffff"/></svg>Back to Class</a>
            <button id="classCodeButton"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.759 3H9.75a.75.75 0 0 0-.75.75v6.5c0 .414.336.75.75.75h2.625c.283 0 .898-.038 1.469-.345.296-.159.594-.398.815-.75.223-.356.341-.785.341-1.28 0-.516-.112-.962-.336-1.33a1.983 1.983 0 0 0-.472-.531c.237-.356.383-.815.383-1.389 0-.502-.096-.935-.291-1.296a1.938 1.938 0 0 0-.768-.78c-.537-.3-1.118-.3-1.333-.299H9.759Zm2.616 6.5H10.5V7.75h1.875c.247 0 .547.01.78.125.1.05.174.113.228.2.054.09.117.254.117.55 0 .248-.057.394-.112.482a.653.653 0 0 1-.255.227c-.25.134-.571.166-.758.166ZM10.5 6.25V4.5h1.663c.218 0 .448.011.621.108.07.04.13.093.18.184.052.096.111.272.111.583 0 .264-.054.422-.107.516a.562.562 0 0 1-.207.212c-.19.116-.442.146-.593.147H10.5ZM5.277 3a.75.75 0 0 1 .696.5L8.28 10a.75.75 0 1 1-1.414.5l-.338-.952H3.826l-.376.973a.75.75 0 1 1-1.4-.542l2.517-6.5A.75.75 0 0 1 5.277 3Zm-.041 2.907-.83 2.141h1.59l-.76-2.141Zm15.292-2.635c.616.302 1.1.872 1.428 1.784a.75.75 0 1 1-1.411.508c-.234-.648-.498-.858-.677-.946-.22-.107-.468-.118-.868-.118-.378 0-.623.12-.802.28-.195.173-.35.428-.464.733a4.157 4.157 0 0 0-.233 1.222v.016c0 .524.007 1.197.229 1.762.105.27.25.487.446.648.192.158.473.295.907.344.352.039 1.129-.022 1.484-.807a.75.75 0 0 1 1.366.62c-.77 1.699-2.459 1.74-3.016 1.678-.69-.077-1.253-.313-1.694-.677a3.043 3.043 0 0 1-.89-1.258C16 8.21 16 7.28 16 6.78V6.733l.001-.035a5.608 5.608 0 0 1 .328-1.71c.167-.446.435-.94.872-1.33.453-.403 1.052-.658 1.8-.658h.038c.36 0 .933-.001 1.489.272ZM16.97 15.138a.857.857 0 0 1 .251-.397c.129-.113.356-.241.778-.241.762 0 1 .5 1 .727 0 .245-.052.49-.19.664-.11.14-.378.359-1.101.359a.75.75 0 0 0 0 1.5c.273 0 .65.036.934.17a.653.653 0 0 1 .264.2c.045.064.093.167.093.357 0 .488-.152.704-.28.812-.151.128-.396.211-.72.211-.362 0-.567-.063-.692-.142-.112-.07-.24-.204-.345-.524a.75.75 0 1 0-1.425.469c.186.566.495 1.023.967 1.322.458.29.982.375 1.495.375.551 0 1.182-.138 1.687-.565.528-.445.813-1.116.813-1.958 0-.474-.13-.888-.371-1.227a1.966 1.966 0 0 0-.258-.294 2.19 2.19 0 0 0 .114-.132c.438-.55.515-1.192.515-1.597C20.5 14.154 19.572 13 18 13c-.765 0-1.351.247-1.77.616-.405.357-.61.789-.701 1.11a.75.75 0 0 0 1.442.412Zm-6.47.385c0-.528.443-1.023.985-1.023.407 0 .735.19.893.434.136.21.218.566-.093 1.095-.15.255-.376.482-.682.724-.152.12-.315.237-.493.363l-.074.052c-.152.107-.315.222-.472.34C9.82 18.069 9 18.855 9 20.25c0 .414.336.75.75.75h3.451a.75.75 0 0 0 0-1.5h-2.513c.16-.282.423-.525.779-.793.137-.103.28-.203.432-.312l.078-.054c.179-.127.37-.264.557-.41.372-.295.76-.658 1.045-1.142.557-.948.546-1.921.058-2.672C13.17 13.4 12.34 13 11.486 13 10.008 13 9 14.278 9 15.523a.75.75 0 0 0 1.5 0Zm-5.585 1.215c.211-.14.415-.3.608-.475v3.987a.75.75 0 0 0 1.5 0v-6.5a.75.75 0 0 0-1.484-.16c-.126.578-.691 1.39-1.456 1.9a.75.75 0 0 0 .832 1.248Z" fill="#ffffff"/></svg>Class Code</button>
        </div>
        <div id="classBannerText" class="classBannerText">
            <h1 id="className">Class Name</h1>
            <p id="classSubTitle">Class Subtitle</p>
        </div>
        <h1 class="classCodeText" id="classCodeText">{{classid}}</h1>
        <img id="classBanner">
    </div>
    <div class="classroomSettingContainer">
        <div>
            <div class="classroomSettingText">
                <h4>Message Lock</h4>
                <p>Students will not be able to send messages.</p>
            </div>
            <input type="checkbox" id="messageLock" class="switch">
        </div>
        <div class="classroomSettingsTitleSubtitle">
            <div>
                <div>
                    <div class="classroomSettingText">
                        <h4>Edit Class Title</h4>
                        <p>Edit the title for this class</p>
                    </div>
                </div>
                <input type="input" value="{{user_class['classInfo']['name']}}" placeholder="Class Title" id="classTitle">
            </div>
            <div>
                <div>
                    <div class="classroomSettingText">
                        <h4>Edit Class Subtitle</h4>
                        <p>Edit the subtitle for this class</p>
                    </div>
                </div>
                <input type="input" value="{{user_class['classInfo']['subtitle']}}" placeholder="Class Subtitle" id="classSubtitle">
            </div>
        </div>
        <div class="classroomSettingsDescription">
            <div>
                <div class="classroomSettingText">
                    <h4>Edit Class Subtitle</h4>
                    <p>Edit the subtitle for this class</p>
                </div>
            </div>
            <textarea placeholder="Class Description" id="classDescription">{{user_class['classInfo']['description']}}</textarea>
        </div>
        <div>
            <div class="classroomSettingText">
                <h4>Delete Class</h4>
                <p>This will remove all data related to this class.</p>
            </div>
            <div class="classroomSettingsButtons">
                <button id="deleteCancelButton" class="whiteButton" style="display: none;">Cancel</button>
                <button id="deleteButton" class="deleteButton">Delete Class</button>
            </div>
        </div>
        <button class="primaryButton" id="saveClassSettings"><svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 5.75A2.75 2.75 0 0 1 5.75 3h9.964a3.25 3.25 0 0 1 2.299.952l2.035 2.035c.61.61.952 1.437.952 2.299v9.964A2.75 2.75 0 0 1 18.25 21H5.75A2.75 2.75 0 0 1 3 18.25V5.75ZM5.75 4.5c-.69 0-1.25.56-1.25 1.25v12.5c0 .69.56 1.25 1.25 1.25H6v-5.25A2.25 2.25 0 0 1 8.25 12h7.5A2.25 2.25 0 0 1 18 14.25v5.25h.25c.69 0 1.25-.56 1.25-1.25V8.286c0-.465-.184-.91-.513-1.238l-2.035-2.035a1.75 1.75 0 0 0-.952-.49V7.25a2.25 2.25 0 0 1-2.25 2.25h-4.5A2.25 2.25 0 0 1 7 7.25V4.5H5.75Zm10.75 15v-5.25a.75.75 0 0 0-.75-.75h-7.5a.75.75 0 0 0-.75.75v5.25h9Zm-8-15v2.75c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75V4.5h-6Z" fill="#ffffff"/></svg>Save Changes</button>
    </div>

</main>
<script>
    const deleteButton = document.getElementById('deleteButton');
    const deleteCancelButton = document.getElementById('deleteCancelButton');
    deleteButton.addEventListener('click', () => {
        if (deleteButton.textContent === 'Delete Class') {
            deleteButton.textContent = 'Confirm Delete';
            deleteButton.classList.add('deleteButtonConfirm');
            deleteCancelButton.style.display = 'inline-block';
        } else {
            // User confirmed deletion, send the request to backend
            const classid = thisClass.classInfo.id;
            fetch('/endpoint/classroom/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ classid: classid })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === "complete") {
                    window.location.href = "/";
                }
            })
            .catch(error => {
                console.error('Error deleting class:', error);
            });
        }

        deleteCancelButton.addEventListener('click', () => {
            deleteButton.textContent = 'Delete Class';
            deleteButton.classList.remove('deleteButtonConfirm');
            deleteCancelButton.style.display = 'none';
        });
    })

    const messageLock = document.getElementById('messageLock');
    const saveClassSettings = document.getElementById('saveClassSettings');

    const className = document.getElementById('className');
    const classSubTitle = document.getElementById('classSubTitle');
    const thisClass = {{user_class|tojson}};

    thisClass.classInfo.settings.messageLock ? messageLock.checked = true : messageLock.checked = false;

    classInfo = thisClass.classInfo;
    className.innerText = classInfo.name;
    classSubTitle.innerText = classInfo.subtitle;
    classBanner.src = "/static/coverImages/classroomBanners/"+classInfo.coverImage+"Gradient.webp"
    const classCodeButton = document.getElementById('classCodeButton');
    const classBannerText = document.getElementById('classBannerText');
    const classCodeText = document.getElementById('classCodeText');
    classCodeText.innerText = classInfo.id;
    let classCodeShown = false;
    classCodeButton.addEventListener('click', () => {
        classCodeShown = !classCodeShown;
        classBannerText.classList.toggle('classBannerTextExpand');
        classCodeText.classList.toggle('classCodeTextExpand');
    });

    saveClassSettings.addEventListener('click', () => {
        const classTitle = document.getElementById('classTitle').value;
        const classSubtitle = document.getElementById('classSubtitle').value;
        const classDescription = document.getElementById('classDescription').value;
        const messageLock = document.getElementById('messageLock').checked;
        const classid = thisClass.classInfo.id;
        const data = {
            "name":classTitle,
            "subtitle":classSubtitle,
            "description":classDescription,
            "messageLock":messageLock,
            "classid":classid
        }
        fetch('/endpoint/classroom/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(res => res.json())
        .then(data => {
            if(data.status == "complete"){
                window.location.href = "/classroom/"+classid;
            }
        })
    })

</script>


{% endblock %}